<%- model_class = Order -%>
<% if current_user %>
    <% if current_user.is_admin? || current_user.is_planer? || (current_user.is_superadmin? && current_user.company_id?)%>
      <div class="page-header">
        <h1><%=t '.title', :default => Order %></h1>
      </div>
      <% if current_user.company.try(:customers).blank? %>
        <div class="alert alert-info">Ihrem Benutzeraccount wurden noch keine Kunden zugewiesen. Sie können daher nur Aufträge importieren und nicht direkt anlegen.</div>
        <%= link_to t('.order_import'), file_order_import_path, class: "btn btn-primary btn-smart" %>
        <% else %>
	      <%= link_to t('.new', :default => t("orders.new.title")), new_order_path, :class => 'btn btn-primary btn-smart' %>
        <%= link_to t('.order_import'), file_order_import_path, class: "btn btn-primary btn-smart" %>
        <div style="float: right;">
          <%= form_tag orders_path, method: :get do %>
            <%= label_tag :active, t('.filter_order_status') %>
            <%= select_tag :active, options_for_select([[t('orders.status.active'), 1], [t('orders.status.inactive'), 0]], params[:active]), prompt: t('orders.filter_order_status_default'), onchange: "this.form.submit();", class: "order_type_filter" %>
            <%= label_tag :order_type, t('.filter_order_type') %>
            <%= select_tag :order_type, options_for_select([[t('orders.types.delivery'), OrderTypeEnum::DELIVERY],
                                                            [t('orders.types.pickup'), OrderTypeEnum::PICKUP],
                                                            [t('orders.types.service'), OrderTypeEnum::SERVICE]], params[:order_type]),
                                                            prompt: t('orders.filter_order_type_default'),
                                                            onchange: "this.form.submit();"%>
          <% end %>
          </div>
          <hr/>
          <table class="table table-striped">
          <thead>
            <tr>
              <th>Abholort</th>
              <th class="center">Einladedauer<br/>[hh:mm:ss]</th>
              <th>Lieferort</th>
              <th class="center">Ausladedauer<br/>[hh:mm:ss]</th>
              <th class="center">Kapazität</th>
              <th class="center">Priorität</th>
              <th class="center"><%= t('attributes.order_type') %></th>
              <th class="center">Aktiv</th>
              <th><%=t '.actions', :default => t("helpers.actions") %></th>
            </tr>
          </thead>
          <tbody>
            <% @orders.each do |order| %>
              <tr>
                <td><%= order.pickup_location %></td>
                <td class="center"><%= Time.at(order.duration_pickup * 60).utc.strftime("%H:%M:%S") %></td>
                <td><%= order.delivery_location %></td>
                <td class="center"><%= Time.at(order.duration_delivery * 60).utc.strftime("%H:%M:%S") %></td>
                <td class="center"><%= order.capacity %></td>
                <% if order.customer %>
                    <td class="center"><%= order.customer.priority %></td>
                <% else %>
                    <td class="center">keine</td>
                <% end %>
                <td><%= order_type_as_string(order.order_type) %></td>
                <td class="center"><div class="active_circle_<%= order.active %>"></div></td>
                <td>
                  <%= link_to t('helpers.links.show'), order, :class => 'btn btn-info btn-xs' %>
                  <%= link_to t('helpers.links.edit'), edit_order_path(order), :class => 'btn btn-warning btn-xs' %>
                  <%= link_to t('helpers.links.destroy'), order, method: :delete, data: { confirm: t('helpers.links.confirm') }, :class => 'btn btn-danger btn-xs' %>
                </td>
              </tr>
            <% end %>
            <tr>
              <td></td>
              <td class="center"><strong><%= Time.at(@orders.inject(0){ |sum, x| sum + x.duration_pickup * 60 }).utc.strftime("%H:%M:%S") %></strong></td>
              <td></td>
              <td class="center"><strong><%= Time.at(@orders.inject(0){ |sum, x| sum + x.duration_delivery * 60 }).utc.strftime("%H:%M:%S") %></strong></td>
              <td></td>
              <td></td>
              <td></td>
              <td></td>
            </tr>
          </tbody>
        </table>

      <% end %>
    <% else %>
    ZUGANG VERWEIGERT
    <% end %>
<% else %>
ZUGANG VERWEIGERT
<% end %>