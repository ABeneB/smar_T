<%- model_class = Tour -%>
<% if current_user %>
  <div class="page-header">
    <h1>Tour</h1>
  </div>

  <div class="fieldset">
    <table class="table table-striped">
      <thead>
        <tr>
          <th><%= model_class.human_attribute_name(:place) %></th>
          <th>Art</th>
          <th><%= model_class.human_attribute_name(:location) %></th>
          <th><%= model_class.human_attribute_name(:time) %></th>
          <th><%= model_class.human_attribute_name(:duration) %></th>
          <th>Beschreibung</th>
        </tr>
      </thead>
      <tbody class="sortable">
        <% @order_tours.each do |order_tour| %>
          <tr id="orderTour-<%= order_tour.id %>">
            <td><%= order_tour.place+1 %></td>
            <td><%= order_tour.kind %></td>
            <td><%= order_tour.location %></td>
            <td><%= order_tour.time %></td>
            <td><%= order_tour.duration %></td>
            <td><%= order_tour.comment %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  
    <% if current_user.is_driver? %>
      <td><%= link_to 'Start', edit_tour_path(@tour), :class => 'btn btn-info' %></td>
      <td><%= link_to 'Pause', edit_tour_path(@tour), :class => 'btn btn-info' %></td>
      <td><%= link_to 'Erledigt', edit_tour_path(@tour), method: :delete, data: { confirm: 'Are you sure?' }, :class => 'btn btn-danger' %></td>
      <input type="text" id="info" disabled>
    <% end %>
  
    <div style='width: 100%'>
      <div id="map" style='width: 100%; height: 400px;'></div>
    </div>

  </div>
  <script>
    function initMap() {
      createMap(document.getElementById('map'));

      <% @order_tours.each_with_index do | order_tour, index | %>
        setMarker(parseFloat(<%= order_tour.latitude%>), parseFloat(<%= order_tour.longitude %>),"<%=order_tour.place+1%>");
        <% if (index < @order_tours.length - 1) %>
          var origin = {lat:<%= @order_tours[index].latitude %>, lng: <%= @order_tours[index].longitude %>};
          var destination = {lat: <%= @order_tours[index + 1].latitude %>, lng: <%= @order_tours[index + 1].longitude %>};
          setRoute(origin, destination);
        <% end %>
      <% end %>
    }
  </script>

    <script async defer
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBGri49KFy_LkR2nG4q0uZTPsNw_iIWx5A&callback=initMap">
    </script>

<% else %>
ZUGANG VERWEIGERT
<% end %>